var RichMessages=function(){function e(e,t){e.facebook&&e.facebook.attachment&&e.facebook.attachment.payload?this.messageData=e.facebook.attachment.payload:e._cognigy&&e._cognigy._facebook&&e._cognigy._facebook.message&&e._cognigy._facebook.message.attachment&&e._cognigy._facebook.message.attachment.payload&&(this.messageData=e._cognigy._facebook.message.attachment.payload),this.messageContainer=t,this.quickReplies=e.facebook&&e.facebook.quick_replies||e._cognigy&&e._cognigy._facebook&&e._cognigy._facebook.message&&e._cognigy._facebook.message.quick_replies,this.quickReplyText=e._cognigy&&e._cognigy._facebook&&e._cognigy._facebook.message}return e.prototype.findTemplate=function(){if(this.messageData)return this.messageData.template_type},e.prototype.findElements=function(){if(this.messageData)return this.messageData.elements},e.prototype.findButtons=function(){if(this.messageData)return this.messageData.buttons},e.prototype.renderQuickReplies=function(){var e=document.createElement("div");if(e.className="quick_reply_container",displayCognigyMessage(this.quickReplyText,messageLogoUrl),!this.quickReplies)return null;this.quickReplies.length>3&&(e.className+=" flex_wrap"),this.quickReplies.forEach(function(t){if(!t.title)return null;var n=document.createElement("button");if(t.image_url){var a=document.createElement("img");a.src=t.image_url,a.style.width="24px",a.style.height="24px",a.style.marginRight="5px",n.appendChild(a)}n.onclick=function(){return handleDisplayPostbackMessage(t.payload),handleCognigyMessage(t.payload)},n.className="quick_reply";var i=document.createTextNode(t.title);n.appendChild(i),e.appendChild(n)}),this.messageContainer.appendChild(e)},e.prototype.renderButton=function(e){var t=this,n=document.createElement("div");n.className="button";var a=document.createTextNode(e.title);return n.appendChild(a),"postback"===e.type&&(n.onclick=function(){return t.handleButtonPostback(e.payload)}),"web_url"==e.type&&(n.onclick=function(){return t.handleButtonWebUrl(e.url)}),n},e.prototype.handleButtonPostback=function(e){handleDisplayPostbackMessage(e),handleCognigyMessage(e)},e.prototype.handleButtonWebUrl=function(e){if(e.match("fbextension")){var t=null!=window.screenLeft?window.screenLeft:screen.left,n=null!=window.screenTop?window.screenTop:screen.top,a=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-450+t,i=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-250+n,o=window.open(e,"cognigyWebchat","scrollbars=yes, width=900, height=500, top="+i+", left="+a);window.focus&&o.focus()}else window.open(e)},e.prototype.renderListButton=function(e){var t=this,n=document.createElement("button");n.className="list_template_element_button";var a=document.createTextNode(e.title);return n.appendChild(a),"postback"===e.type&&(n.onclick=function(){return t.handleButtonPostback(e.payload)}),"web_url"==e.type&&(n.onclick=function(){return t.handleButtonWebUrl(e.url)}),n},e.prototype.renderListElement=function(e,t){var n=document.createElement("div"),a=document.createElement("div"),i=document.createTextNode(e.title),o=document.createElement("p");o.className="text_subtitle";var c=document.createTextNode(e.subtitle.replace(/\n\s*\n/g,"\n"));if(o.appendChild(c),e.subtitle&&readCognigyMessage(e.subtitle),a.appendChild(i),a.appendChild(o),"large"===this.messageData.top_element_style&&0===t)n.className="list_template_element_container_first",a.className="list_template_element_content_first",n.style.background="url("+e.image_url+") center center / cover no-repeat, linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)) no-repeat",n.appendChild(a);else{n.className="list_template_element_container",a.className="list_template_element_content",n.appendChild(a);var s=document.createElement("img");s.src=e.image_url,s.style.minWidth="50px",s.style.height="50px",n.appendChild(s),e.default_action&&(s.onclick=function(){return window.open(e.default_action.url)})}return{elementContainer:n,elementContent:a}},e.prototype.listTemplate=function(){var e=this,t=createElement("div","cognigy-chat-bot-message-container");this.createAvatar(t);var n=document.createElement("div");n.className="list_template_container",this.findElements().forEach(function(t,a){var i=e.renderListElement(t,a),o=i.elementContainer,c=i.elementContent;t.buttons&&t.buttons.forEach(function(t){var n=e.renderListButton(t);"large"===e.messageData.top_element_style&&0===a&&(n.className="list_template_element_button_first"),c.appendChild(n)}),e.findElements().length===a+1&&(o.style.borderBottom="none"),n.appendChild(o)}),this.findButtons()&&this.findButtons().forEach(function(t,a){var i=e.renderButton(t);n.appendChild(i)}),t.appendChild(n),this.messageContainer.appendChild(t)},e.prototype.renderInformation=function(e){var t=document.createElement("span"),n=document.createElement("div");return n.className="receipt_template_information_container",t.className="receipt_template_information",t.appendChild(e),n.appendChild(t),n},e.prototype.carouselButtons=function(e,t){var n=document.createElement("div");n.className="generic_template_carousel_buttons_container";var a=document.createElement("div");a.className="generic_template_increment",a.id="genericTemplateIncrement"+t;var i=document.createElement("div");i.className="visibility_hidden",i.id="genericTemplateDecrement"+t,n.appendChild(i),n.appendChild(a);return this.findElements()&&(e[0].className="generic_template_element_container",a.addEventListener("click",function(){e[t].className="display_none",e[t+1].className="generic_template_element_container",document.getElementById("genericTemplateDecrement"+(t+1)).className="generic_template_decrement",t===e.length-2&&(document.getElementById("genericTemplateIncrement"+(t+1)).className="visibility_hidden")}),i.addEventListener("click",function(){e[t].className="display_none",e[t-1].className="generic_template_element_container",document.getElementById("genericTemplateIncrement"+(t-1)).className="generic_template_increment",0===t&&(document.getElementById("genericTemplateDecrement"+(t-1)).className="visibility_hidden")})),n},e.prototype.genericTemplate=function(){var e=this,t=createElement("div","cognigy-chat-bot-message-container");this.createAvatar(t);var n=document.createElement("div");n.className="generic_template_container";var a=[];this.findElements().forEach(function(t,i){var o=document.createElement("div");a.push(o);var c=document.createElement("img");if(c.src=t.image_url,c.style.width="100%",c.style.height="200px",c.style.borderRadius="10px 10px 0 0",o.appendChild(c),t.default_action&&(c.onclick=function(){return window.open(t.default_action.url)}),e.findElements().length>1){o.className="display_none";var s=e.carouselButtons(a,i);o.appendChild(s)}var l=document.createElement("div");if(l.className="generic_template_text_container",o.appendChild(l),t.title){var r=document.createElement("p");r.className="text_title";var d=document.createTextNode(t.title);r.appendChild(d),l.appendChild(r)}if(t.subtitle){var m=document.createElement("p");m.className="text_subtitle";var p=document.createTextNode(t.subtitle.replace(/\n\s*\n/g,"\n"));t.subtitle&&readCognigyMessage(t.subtitle),m.appendChild(p),l.appendChild(m)}t.buttons&&t.buttons.forEach(function(t){var n=e.renderButton(t);o.appendChild(n)}),n.appendChild(o)}),this.findButtons()&&this.findButtons().forEach(function(t){var a=e.renderButton(t);n.appendChild(a)}),t.appendChild(n),this.messageContainer.appendChild(t)},e.prototype.buttonTemplate=function(){var e=this,t=createElement("div","cognigy-chat-bot-message-container");this.createAvatar(t);var n=document.createElement("div");if(n.className="button_template_outer_container",this.messageData.text){readCognigyMessage(this.messageData.text);var a=document.createElement("div");a.className="button_template_text",a.appendChild(document.createTextNode(this.messageData.text)),n.appendChild(a)}this.messageData.buttons.forEach(function(t,a){var i=e.renderButton(t);0!==a&&(i.style.borderTop="1px solid rgba(0,0,0,0.1)"),i.className="button_template_container",n.appendChild(i)}),t.appendChild(n),this.messageContainer.appendChild(t)},e.prototype.createAvatar=function(e){var t=createElement("img","cognigy-chat-bot-avatar"),n=new Image;n.onload=function(){t.src=messageLogoUrl},n.onerror=function(){t.src="./images/cognigy_logo.svg"},n.src=messageLogoUrl,e.appendChild(t)},e.prototype.renderMessage=function(){"button"===this.findTemplate()&&this.buttonTemplate(),"list"===this.findTemplate()&&this.listTemplate(),"generic"===this.findTemplate()&&this.genericTemplate(),(this.quickReplies||this.quickReplyText)&&this.renderQuickReplies()},e}(),createElement=function(e,t,n){var a=document.createElement(e);return a.className=t,n&&(a.id=n),a};