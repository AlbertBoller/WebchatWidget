var RichMessages=function(){function a(b,c){b.facebook&&b.facebook.attachment&&b.facebook.attachment.payload?this.messageData=b.facebook.attachment.payload:b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.attachment&&b._cognigy._facebook.message.attachment.payload&&(this.messageData=b._cognigy._facebook.message.attachment.payload),this.messageContainer=c,this.quickReplies=b.facebook&&b.facebook.quick_replies||b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.quick_replies,this.quickReplyText=b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message}return a.prototype.findTemplate=function(){if(this.messageData)return this.messageData.template_type},a.prototype.findElements=function(){if(this.messageData)return this.messageData.elements},a.prototype.findButtons=function(){if(this.messageData)return this.messageData.buttons},a.prototype.renderQuickReplies=function(){var b=document.createElement("div");return b.className="quick_reply_container",displayCognigyMessage(this.quickReplyText,logoUrl),this.quickReplies?void(3<this.quickReplies.length&&(b.className+=" flex_wrap"),this.quickReplies.forEach(function(c){if(!c.title)return null;var d=document.createElement("button");if(c.image_url){var e=document.createElement("img");e.src=c.image_url,e.style.width="24px",e.style.height="24px",e.style.marginRight="5px",d.appendChild(e)}d.onclick=function(){return handleDisplayPostbackMessage(c.payload),handleCognigyMessage(c.payload)},d.className="quick_reply";var f=document.createTextNode(c.title);d.appendChild(f),b.appendChild(d)}),this.messageContainer.appendChild(b)):null},a.prototype.renderButton=function(b){var c=this,d=document.createElement("div");d.className="button";var e=document.createTextNode(b.title);return d.appendChild(e),"postback"===b.type&&(d.onclick=function(){return c.handleButtonPostback(b.payload)}),"web_url"==b.type&&(d.onclick=function(){return c.handleButtonWebUrl(b.url)}),d},a.prototype.handleButtonPostback=function(b){handleDisplayPostbackMessage(b),handleCognigyMessage(b)},a.prototype.handleButtonWebUrl=function(b){if(b.match("fbextension")){var c=void 0==window.screenLeft?screen.left:window.screenLeft,d=void 0==window.screenTop?screen.top:window.screenTop,e=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,f=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,g=900,j=500,m=window.open(b,"cognigyWebchat","scrollbars=yes, width="+g+", height="+j+", top="+(f/2-j/2+d)+", left="+(e/2-g/2+c));window.focus&&m.focus()}else window.open(b)},a.prototype.renderListButton=function(b){var c=this,d=document.createElement("button");d.className="list_template_element_button";var e=document.createTextNode(b.title);return d.appendChild(e),"postback"===b.type&&(d.onclick=function(){return c.handleButtonPostback(b.payload)}),"web_url"==b.type&&(d.onclick=function(){return c.handleButtonWebUrl(b.url)}),d},a.prototype.renderListElement=function(b,c){var d=document.createElement("div"),e=document.createElement("div"),f=document.createTextNode(b.title);if(e.appendChild(f),"large"===this.messageData.top_element_style&&0===c)d.className="list_template_element_container_first",e.className="list_template_element_content_first",d.style.background="url("+b.image_url+") center center / cover no-repeat, linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)) no-repeat",d.appendChild(e);else{d.className="list_template_element_container",e.className="list_template_element_content",d.appendChild(e);var g=document.createElement("img");g.src=b.image_url,g.style.minWidth="50px",g.style.height="50px",d.appendChild(g),b.default_action&&(g.onclick=function(){return window.open(b.default_action.url)})}return{elementContainer:d,elementContent:e}},a.prototype.listTemplate=function(){var b=this,c=createElement("div","cognigy-chat-bot-message-container");this.createAvatar(c);var d=document.createElement("div");d.className="list_template_container",this.findElements().forEach(function(e,f){var g=b.renderListElement(e,f),j=g.elementContainer,k=g.elementContent;e.buttons&&e.buttons.forEach(function(l){var m=b.renderListButton(l);"large"===b.messageData.top_element_style&&0===f&&(m.className="list_template_element_button_first"),k.appendChild(m)}),b.findElements().length===f+1&&(j.style.borderBottom="none"),d.appendChild(j)}),this.findButtons()&&this.findButtons().forEach(function(e){var g=b.renderButton(e);d.appendChild(g)}),c.appendChild(d),this.messageContainer.appendChild(c)},a.prototype.renderInformation=function(b){var c=document.createElement("span"),d=document.createElement("div");return d.className="receipt_template_information_container",c.className="receipt_template_information",c.appendChild(b),d.appendChild(c),d},a.prototype.carouselButtons=function(b,c){var d=document.createElement("div");d.className="generic_template_carousel_buttons_container";var e=document.createElement("div");e.className="generic_template_increment",e.id="genericTemplateIncrement"+c;var f=document.createElement("div");f.className="visibility_hidden",f.id="genericTemplateDecrement"+c,d.appendChild(f),d.appendChild(e);return this.findElements()&&(b[0].className="generic_template_element_container",e.addEventListener("click",function(){b[c].className="display_none",b[c+1].className="generic_template_element_container",document.getElementById("genericTemplateDecrement"+(c+1)).className="generic_template_decrement",c===b.length-2&&(document.getElementById("genericTemplateIncrement"+(c+1)).className="visibility_hidden")}),f.addEventListener("click",function(){b[c].className="display_none",b[c-1].className="generic_template_element_container",document.getElementById("genericTemplateIncrement"+(c-1)).className="generic_template_increment",0===c&&(document.getElementById("genericTemplateDecrement"+(c-1)).className="visibility_hidden")})),d},a.prototype.genericTemplate=function(){var b=this,c=createElement("div","cognigy-chat-bot-message-container");this.createAvatar(c);var d=document.createElement("div");d.className="generic_template_container";var e=[];this.findElements().forEach(function(f,g){var j=document.createElement("div");e.push(j);var k=document.createElement("img");if(k.src=f.image_url,k.style.width="100%",k.style.height="200px",k.style.borderRadius="10px 10px 0 0",j.appendChild(k),f.default_action&&(k.onclick=function(){return window.open(f.default_action.url)}),1<b.findElements().length){j.className="display_none";var l=b.carouselButtons(e,g);j.appendChild(l)}var m=document.createElement("div");if(m.className="generic_template_text_container",j.appendChild(m),f.title){var n=document.createElement("p");n.className="text_title";var o=document.createTextNode(f.title);n.appendChild(o),m.appendChild(n)}if(f.subtitle){var p=document.createElement("p");p.className="text_subtitle";var q=document.createTextNode(f.subtitle);p.appendChild(q),m.appendChild(p)}f.buttons&&f.buttons.forEach(function(r){var s=b.renderButton(r);j.appendChild(s)}),d.appendChild(j)}),this.findButtons()&&this.findButtons().forEach(function(f){var g=b.renderButton(f);d.appendChild(g)}),c.appendChild(d),this.messageContainer.appendChild(c)},a.prototype.buttonTemplate=function(){var b=this,c=createElement("div","cognigy-chat-bot-message-container");this.createAvatar(c);var d=document.createElement("div");if(d.className="button_template_outer_container",this.messageData.text){var e=document.createElement("div");e.className="button_template_text",e.appendChild(document.createTextNode(this.messageData.text)),d.appendChild(e)}this.messageData.buttons.forEach(function(f,g){var j=b.renderButton(f);0!==g&&(j.style.borderTop="1px solid rgba(0,0,0,0.1)"),j.className="button_template_container",d.appendChild(j)}),c.appendChild(d),this.messageContainer.appendChild(c)},a.prototype.createAvatar=function(b){var c=createElement("img","cognigy-chat-bot-avatar"),d=new Image;d.onload=function(){c.src=logoUrl},d.onerror=function(){c.src="./images/cognigy_logo.svg"},d.src=logoUrl,b.appendChild(c)},a.prototype.renderMessage=function(){"button"===this.findTemplate()&&this.buttonTemplate(),"list"===this.findTemplate()&&this.listTemplate(),"generic"===this.findTemplate()&&this.genericTemplate(),(this.quickReplies||this.quickReplyText)&&this.renderQuickReplies()},a}(),createElement=function(a,b,c){var d=document.createElement(a);return d.className=b,c&&(d.id=c),d};