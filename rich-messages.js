"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var RichMessages=function(){function a(b,c){_classCallCheck(this,a),b.facebook&&b.facebook.attachment&&b.facebook.attachment.payload?this.messageData=b.facebook.attachment.payload:b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.attachment&&b._cognigy._facebook.message.attachment.payload&&(this.messageData=b._cognigy._facebook.message.attachment.payload,this.messageType=b._cognigy._facebook.message.attachment.type),this.messageContainer=c,this.quickReplies=b.facebook&&b.facebook.quick_replies||b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.quick_replies,this.quickReplyText=b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message}return a.prototype.findTemplate=function(){if(this.messageData)return this.messageData.template_type},a.prototype.findElements=function(){if(this.messageData)return this.messageData.elements},a.prototype.findButtons=function(){if(this.messageData)return this.messageData.buttons},a.prototype.renderQuickReplies=function(){var c=this,d=document.createElement("div");return d.className="quick_reply_container",displayCognigyMessage(this.quickReplyText),this.quickReplies?void(3<this.quickReplies.length&&(d.className+=" flex_wrap"),this.quickReplies.forEach(function(e){if(!e.title)return null;if(e.image_url){var f=document.createElement("img");f.src=e.image_url,f.style.width="24px",f.style.height="24px",f.style.marginRight="5px",g.appendChild(f)}var g=document.createElement("button");g.onclick=function(){return c.handleButtonPostback(e.payload)},g.className="quick_reply",g.appendChild(e.title),d.appendChild(g)}),this.messageContainer.appendChild(d)):null},a.prototype.renderButton=function(c){var d=this,e=document.createElement("div");return e.className="button",e.appendChild(c.title),"postback"===c.type&&(e.onclick=function(){return d.handleButtonPostback(c.payload)}),"web_url"==c.type&&(e.onclick=function(){return d.handleButtonWebUrl(c.url)}),e},a.prototype.handleButtonPostback=function(c){handleDisplayPostbackMessage(c),handleCognigyMessage(c)},a.prototype.handleButtonWebUrl=function(c){window.open(c)},a.prototype.renderListButton=function(c){var d=this,e=document.createElement("button");return e.className="list_template_element_button",e.appendChild(c.title),"postback"===c.type&&(e.onclick=function(){return d.handleButtonPostback(c.payload)}),"web_url"==c.type&&(e.onclick=function(){return d.handleButtonWebUrl(c.url)}),e},a.prototype.renderListElement=function(c,d){var e=document.createElement("div"),f=document.createElement("div");if("large"===this.messageData.top_element_style&&0===d)e.className="list_template_element_container_first",f.className="list_template_element_content_first",e.style.background="url("+c.image_url+") center center / cover no-repeat, linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)) no-repeat",f.appendChild(c.title),e.appendChild(f);else{e.className="list_template_element_container",f.className="list_template_element_content",f.appendChild(c.title),e.appendChild(f);var g=document.createElement("img");g.src=c.image_url,g.style.minWidth="50px",g.style.height="50px",e.appendChild(g),c.default_action&&(g.onclick=function(){return window.open(c.default_action.url)})}return{elementContainer:e,elementContent:f}},a.prototype.listTemplate=function(){var c=this,d=document.createElement("div");d.className="list_template_container",this.findElements().forEach(function(e,f){var g=c.renderListElement(e,f),h=g.elementContainer,j=g.elementContent;e.buttons&&e.buttons.forEach(function(k){var l=c.renderListButton(k);"large"===c.messageData.top_element_style&&0===f&&(l.className="list_template_element_button_first"),j.appendChild(l)}),c.findElements().length===f+1&&(h.style.borderBottom="none"),d.appendChild(h)}),this.findButtons()&&this.findButtons().forEach(function(e){var g=c.renderButton(e);d.appendChild(g)}),this.messageContainer.appendChild(d)},a.prototype.renderInformation=function(c){var d=document.createElement("span"),e=document.createElement("div");return e.className="receipt_template_information_container",d.className="receipt_template_information",d.appendChild(c),e.appendChild(d),e},a.prototype.carouselButtons=function(c,d){var e=document.createElement("div");e.className="generic_template_carousel_buttons_container";var f=document.createElement("div");f.className="generic_template_increment",f.id="genericTemplateIncrement"+d;var g=document.createElement("div");g.className="visibility_hidden",g.id="genericTemplateDecrement"+d,e.appendChild(g),e.appendChild(f);return this.findElements()&&(c[0].className="generic_template_element_container",f.addEventListener("click",function(){c[d].className="display_none",c[d+1].className="generic_template_element_container",document.getElementById("genericTemplateDecrement"+(d+1)).className="generic_template_decrement",d===c.length-2&&(document.getElementById("genericTemplateIncrement"+(d+1)).className="visibility_hidden")}),g.addEventListener("click",function(){c[d].className="display_none",c[d-1].className="generic_template_element_container",document.getElementById("genericTemplateIncrement"+(d-1)).className="generic_template_increment",0===d&&(document.getElementById("genericTemplateDecrement"+(d-1)).className="visibility_hidden")})),e},a.prototype.genericTemplate=function(){var c=this,d=document.createElement("div");d.className="generic_template_container";var e=[];this.findElements().forEach(function(f,g){var h=document.createElement("div");e.push(h);var j=document.createElement("img");if(j.src=f.image_url,j.style.width="100%",j.style.height="200px",j.style.borderRadius="10px 10px 0 0",h.appendChild(j),f.default_action&&(j.onclick=function(){return window.open(f.default_action.url)}),1<c.findElements().length){h.className="display_none";var k=c.carouselButtons(e,g);h.appendChild(k)}var l=document.createElement("div");if(l.className="generic_template_text_container",h.appendChild(l),f.title){var m=document.createElement("p");m.className="text_title",m.appendChild(f.title),l.appendChild(m)}if(f.subtitle){var n=document.createElement("p");n.className="text_subtitle",n.appendChild(f.subtitle),l.appendChild(n)}f.buttons&&f.buttons.forEach(function(o){var p=c.renderButton(o);h.appendChild(p)}),d.appendChild(h)}),this.findButtons()&&this.findButtons().forEach(function(f){var g=c.renderButton(f);listContainer.appendChild(g)}),this.messageContainer.appendChild(d)},a.prototype.receiptTemplate=function(){var c=this,d=document.createElement("div");d.className="receipt_template_outer_container";var e=document.createElement("div");e.className="receipt_template_header_container",e.appendChild("Order confirmation"),d.appendChild(e),this.findElements()&&this.findElements().forEach(function(v){var w=document.createElement("div");if(w.className="receipt_template_element_container",v.image_url){var x=document.createElement("img");x.style.width="50px",x.style.height="50px",x.style.border="1px solid rgba(0,0,0,0.1)",w.appendChild(x)}var y=document.createElement("div");y.className="receipt_template_text_container";var z=document.createElement("span");z.className="text_title",z.appendChild(v.title),y.appendChild(z);var A=document.createElement("span");A.className="text_subtitle",A.appendChild(v.subtitle),y.appendChild(A),w.appendChild(y),d.appendChild(w)});var f=this.renderInformation("Paid with");this.messageData.payment_method&&f.appendChild(this.messageData.payment_method),d.appendChild(f);var g=this.renderInformation("Ship to");if(this.messageData.address){var h=this.messageData.address;g.appendChild(h.street_1+" \n                                    "+h.city+" "+h.state+" "+h.postal_code)}d.appendChild(g);var j=this.renderInformation("Recipient");this.messageData.recipient_name&&j.appendChild(this.messageData.recipient_name),d.appendChild(j);var k=this.renderInformation("Order number");this.messageData.order_number&&k.appendChild(this.messageData.order_number),d.appendChild(k);var l=this.renderInformation("Order URL");if(this.messageData.order_url){var m=document.createElement("span");m.className="word_break",m.appendChild(this.messageData.order_url),l.appendChild(m)}d.appendChild(l);var n=this.renderInformation("Subtotal");this.messageData.summary&&this.messageData.summary.subtotal&&n.appendChild("$"+this.messageData.summary.subtotal),d.appendChild(n);var o=this.renderInformation("Shipping cost");this.messageData.summary&&this.messageData.summary.shipping_cost&&o.appendChild("$"+this.messageData.summary.shipping_cost),d.appendChild(o);var p=this.renderInformation("Total tax");this.messageData.summary&&this.messageData.summary.total_tax&&p.appendChild("$"+this.messageData.summary.total_tax),d.appendChild(p);var q=document.createElement("span"),r=document.createElement("div");r.className="receipt_template_information_container",q.className="text_title",q.appendChild("Adjustments"),r.appendChild(q),d.appendChild(r),this.messageData.adjustments&&this.messageData.adjustments.forEach(function(v){var w=c.renderInformation(v.name);w.style.marginTop="0px",w.appendChild("Amount:"+v.amount),d.appendChild(w)});var s=document.createElement("div");s.className="receipt_template_summary_container";var t=document.createElement("span");t.className="receipt_template_summary_total",t.appendChild("Total");var u=document.createElement("span");u.className="receipt_template_summary_price",this.messageData.summary&&this.messageData.summary.total_cost&&u.appendChild("$"+this.messageData.summary.total_cost),s.appendChild(t),s.appendChild(u),d.appendChild(s),this.messageContainer.appendChild(d)},a.prototype.buttonTemplate=function(){var c=this,d=document.createElement("div");if(d.className="button_template_outer_container",this.messageData.text){var e=document.createElement("div");e.className="button_template_text",e.appendChild(document.createTextNode(this.messageData.text)),d.appendChild(e)}this.messageData.buttons.forEach(function(g,h){var j=c.renderButton(g);0!==h&&(j.style.borderTop="1px solid rgba(0,0,0,0.1)"),j.className="button_template_container",d.appendChild(j)}),this.messageContainer.appendChild(d);var f=createElement("img","cognigy-chat-bot-avatar");f.src="./images/cognigy_logo.svg",this.messageContainer.appendChild(f)},a.prototype.renderMessage=function(){if("button"===this.findTemplate()&&this.buttonTemplate(),"list"===this.findTemplate()&&this.listTemplate(),"generic"===this.findTemplate()&&this.genericTemplate(),"receipt"===this.findTemplate()&&this.receiptTemplate(),this.renderQuickReplies(),"image"===this.messageType){var c=document.createElement("img");c.src=this.messageData.url,c.className="image_template",this.messageContainer.appendChild(c);var d=createElement("img","cognigy-chat-bot-avatar");d.src="./images/cognigy_logo.svg",this.messageContainer.appendChild(d)}},a}();