var RichMessages=function(){function a(b,c){b.facebook&&b.facebook.attachment&&b.facebook.attachment.payload?this.messageData=b.facebook.attachment.payload:b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.attachment&&b._cognigy._facebook.message.attachment.payload&&(this.messageData=b._cognigy._facebook.message.attachment.payload),this.messageContainer=c,this.quickReplies=b.facebook&&b.facebook.quick_replies||b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.quick_replies,this.quickReplyText=b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message}return a.prototype.findTemplate=function(){if(this.messageData)return this.messageData.template_type},a.prototype.findElements=function(){if(this.messageData)return this.messageData.elements},a.prototype.findButtons=function(){if(this.messageData)return this.messageData.buttons},a.prototype.renderQuickReplies=function(){var b=document.createElement("div");return b.className="quick_reply_container",displayCognigyMessage(this.quickReplyText,logoUrl),this.quickReplies?void(3<this.quickReplies.length&&(b.className+=" flex_wrap"),this.quickReplies.forEach(function(c){if(!c.title)return null;var d=document.createElement("button");if(c.image_url){var e=document.createElement("img");e.src=c.image_url,e.style.width="24px",e.style.height="24px",e.style.marginRight="5px",d.appendChild(e)}d.onclick=function(){return handleDisplayPostbackMessage(c.payload),handleCognigyMessage(c.payload)},d.className="quick_reply";var f=document.createTextNode(c.title);d.appendChild(f),b.appendChild(d)}),this.messageContainer.appendChild(b)):null},a.prototype.renderButton=function(b){var c=this,d=document.createElement("div");d.className="button";var e=document.createTextNode(b.title);return d.appendChild(e),"postback"===b.type&&(d.onclick=function(){return c.handleButtonPostback(b.payload)}),"web_url"==b.type&&(d.onclick=function(){return c.handleButtonWebUrl(b.url)}),d},a.prototype.handleButtonPostback=function(b){handleDisplayPostbackMessage(b),handleCognigyMessage(b)},a.prototype.handleButtonWebUrl=function(b){if(b.match("fbextension")){var c=void 0==window.screenLeft?screen.left:window.screenLeft,d=void 0==window.screenTop?screen.top:window.screenTop,e=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,f=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,g=900,j=500,m=window.open(b,"cognigyWebchat","scrollbars=yes, width="+g+", height="+j+", top="+(f/2-j/2+d)+", left="+(e/2-g/2+c));window.focus&&m.focus()}else window.open(b)},a.prototype.renderListButton=function(b){var c=this,d=document.createElement("button");d.className="list_template_element_button";var e=document.createTextNode(b.title);return d.appendChild(e),"postback"===b.type&&(d.onclick=function(){return c.handleButtonPostback(b.payload)}),"web_url"==b.type&&(d.onclick=function(){return c.handleButtonWebUrl(b.url)}),d},a.prototype.renderListElement=function(b,c){var d=document.createElement("div"),e=document.createElement("div"),f=document.createTextNode(b.title);if(e.appendChild(f),"large"===this.messageData.top_element_style&&0===c)d.className="list_template_element_container_first",e.className="list_template_element_content_first",d.style.background="url("+b.image_url+") center center / cover no-repeat, linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)) no-repeat",d.appendChild(e);else{d.className="list_template_element_container",e.className="list_template_element_content",d.appendChild(e);var g=document.createElement("img");g.src=b.image_url,g.style.minWidth="50px",g.style.height="50px",d.appendChild(g),b.default_action&&(g.onclick=function(){return window.open(b.default_action.url)})}return{elementContainer:d,elementContent:e}},a.prototype.listTemplate=function(){var b=this,c=document.createElement("div");c.className="list_template_container",this.findElements().forEach(function(d,e){var f=b.renderListElement(d,e),g=f.elementContainer,j=f.elementContent;d.buttons&&d.buttons.forEach(function(k){var l=b.renderListButton(k);"large"===b.messageData.top_element_style&&0===e&&(l.className="list_template_element_button_first"),j.appendChild(l)}),b.findElements().length===e+1&&(g.style.borderBottom="none"),c.appendChild(g)}),this.findButtons()&&this.findButtons().forEach(function(d){var f=b.renderButton(d);c.appendChild(f)}),this.messageContainer.appendChild(c)},a.prototype.renderInformation=function(b){var c=document.createElement("span"),d=document.createElement("div");return d.className="receipt_template_information_container",c.className="receipt_template_information",c.appendChild(b),d.appendChild(c),d},a.prototype.carouselButtons=function(b,c){var d=document.createElement("div");d.className="generic_template_carousel_buttons_container";var e=document.createElement("div");e.className="generic_template_increment",e.id="genericTemplateIncrement"+c;var f=document.createElement("div");f.className="visibility_hidden",f.id="genericTemplateDecrement"+c,d.appendChild(f),d.appendChild(e);return this.findElements()&&(b[0].className="generic_template_element_container",e.addEventListener("click",function(){b[c].className="display_none",b[c+1].className="generic_template_element_container",document.getElementById("genericTemplateDecrement"+(c+1)).className="generic_template_decrement",c===b.length-2&&(document.getElementById("genericTemplateIncrement"+(c+1)).className="visibility_hidden")}),f.addEventListener("click",function(){b[c].className="display_none",b[c-1].className="generic_template_element_container",document.getElementById("genericTemplateIncrement"+(c-1)).className="generic_template_increment",0===c&&(document.getElementById("genericTemplateDecrement"+(c-1)).className="visibility_hidden")})),d},a.prototype.genericTemplate=function(){var b=this,c=document.createElement("div");c.className="generic_template_container";var d=[];this.findElements().forEach(function(e,f){var g=document.createElement("div");d.push(g);var j=document.createElement("img");if(j.src=e.image_url,j.style.width="100%",j.style.height="200px",j.style.borderRadius="10px 10px 0 0",g.appendChild(j),e.default_action&&(j.onclick=function(){return window.open(e.default_action.url)}),1<b.findElements().length){g.className="display_none";var k=b.carouselButtons(d,f);g.appendChild(k)}var l=document.createElement("div");if(l.className="generic_template_text_container",g.appendChild(l),e.title){var m=document.createElement("p");m.className="text_title";var n=document.createTextNode(e.title);m.appendChild(n),l.appendChild(m)}if(e.subtitle){var o=document.createElement("p");o.className="text_subtitle";var p=document.createTextNode(e.subtitle);o.appendChild(p),l.appendChild(o)}e.buttons&&e.buttons.forEach(function(q){var r=b.renderButton(q);g.appendChild(r)}),c.appendChild(g)}),this.findButtons()&&this.findButtons().forEach(function(e){var f=b.renderButton(e);c.appendChild(f)}),this.messageContainer.appendChild(c)},a.prototype.buttonTemplate=function(){var b=this,c=document.createElement("div");if(c.className="button_template_outer_container",this.messageData.text){var d=document.createElement("div");d.className="button_template_text",d.appendChild(document.createTextNode(this.messageData.text)),c.appendChild(d)}this.messageData.buttons.forEach(function(e,f){var g=b.renderButton(e);0!==f&&(g.style.borderTop="1px solid rgba(0,0,0,0.1)"),g.className="button_template_container",c.appendChild(g)}),this.messageContainer.appendChild(c)},a.prototype.createAvatar=function(){var b=createElement("img","cognigy-chat-bot-avatar"),c=new Image;c.onload=function(){b.src=logoUrl},c.onerror=function(){b.src="./images/cognigy_logo.svg"},c.src=logoUrl,this.messageContainer.appendChild(b)},a.prototype.renderMessage=function(){"button"===this.findTemplate()&&(this.buttonTemplate(),this.createAvatar()),"list"===this.findTemplate()&&(this.listTemplate(),this.createAvatar()),"generic"===this.findTemplate()&&(this.genericTemplate(),this.createAvatar()),(this.quickReplies||this.quickReplyText)&&this.renderQuickReplies()},a}(),createElement=function(a,b,c){var d=document.createElement(a);return d.className=b,c&&(d.id=c),d};