"use strict";var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var RichMessages=function(){function a(b,c){_classCallCheck(this,a),b.facebook&&b.facebook.attachment&&b.facebook.attachment.payload?this.messageData=b.facebook.attachment.payload:b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.attachment&&b._cognigy._facebook.message.attachment.payload&&(this.messageData=b._cognigy._facebook.message.attachment.payload,this.messageType=b._cognigy._facebook.message.attachment.type),this.messageContainer=c,this.quickReplies=b.facebook&&b.facebook.quick_replies||b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message&&b._cognigy._facebook.message.quick_replies,this.quickReplyText=b._cognigy&&b._cognigy._facebook&&b._cognigy._facebook.message}return _createClass(a,[{key:"findTemplate",value:function(){if(this.messageData)return this.messageData.template_type}},{key:"findElements",value:function(){if(this.messageData)return this.messageData.elements}},{key:"findButtons",value:function(){if(this.messageData)return this.messageData.buttons}},{key:"renderQuickReplies",value:function(){var c=this,d=document.createElement("div");return d.className="quick_reply_container",displayCognigyMessage(this.quickReplyText),this.quickReplies?void(3<this.quickReplies.length&&(d.className+=" flex_wrap"),this.quickReplies.forEach(function(e){if(!e.title)return null;var f=document.createElement("button");if(f.onclick=function(){return c.handleButtonPostback(e.payload)},f.className="quick_reply",f.append(e.title),e.image_url){var g=document.createElement("img");g.src=e.image_url,g.style.width="24px",g.style.height="24px",g.style.marginRight="5px",f.prepend(g)}d.append(f)}),this.messageContainer.append(d)):null}},{key:"renderButton",value:function(c){var d=this,e=document.createElement("div");return e.className="button",e.append(c.title),"postback"===c.type&&(e.onclick=function(){return d.handleButtonPostback(c.payload)}),"web_url"==c.type&&(e.onclick=function(){return d.handleButtonWebUrl(c.url)}),e}},{key:"handleButtonPostback",value:function(c){handleDisplayPostbackMessage(c),handleCognigyMessage(c)}},{key:"handleButtonWebUrl",value:function(c){window.open(c)}},{key:"renderListButton",value:function(c){var d=this,e=document.createElement("button");return e.className="list_template_element_button",e.append(c.title),"postback"===c.type&&(e.onclick=function(){return d.handleButtonPostback(c.payload)}),"web_url"==c.type&&(e.onclick=function(){return d.handleButtonWebUrl(c.url)}),e}},{key:"renderListElement",value:function(c,d){var e=document.createElement("div"),f=document.createElement("div");if("large"===this.messageData.top_element_style&&0===d)e.className="list_template_element_container_first",f.className="list_template_element_content_first",e.style.background="url("+c.image_url+") center center / cover no-repeat, linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)) no-repeat",f.append(c.title),e.append(f);else{e.className="list_template_element_container",f.className="list_template_element_content",f.append(c.title),e.append(f);var g=document.createElement("img");g.src=c.image_url,g.style.minWidth="50px",g.style.height="50px",e.append(g),c.default_action&&(g.onclick=function(){return window.open(c.default_action.url)})}return{elementContainer:e,elementContent:f}}},{key:"listTemplate",value:function(){var c=this,d=document.createElement("div");d.className="list_template_container",this.findElements().forEach(function(e,f){var g=c.renderListElement(e,f),h=g.elementContainer,j=g.elementContent;e.buttons&&e.buttons.forEach(function(k){var l=c.renderListButton(k);"large"===c.messageData.top_element_style&&0===f&&(l.className="list_template_element_button_first"),j.append(l)}),c.findElements().length===f+1&&(h.style.borderBottom="none"),d.append(h)}),this.findButtons()&&this.findButtons().forEach(function(e){var g=c.renderButton(e);d.append(g)}),this.messageContainer.append(d)}},{key:"renderInformation",value:function(c){var d=document.createElement("span"),e=document.createElement("div");return e.className="receipt_template_information_container",d.className="receipt_template_information",d.append(c),e.append(d),e}},{key:"carouselButtons",value:function(c,d){var e=document.createElement("div");e.className="generic_template_carousel_buttons_container";var f=document.createElement("div");f.className="generic_template_increment",f.id="genericTemplateIncrement"+d;var g=document.createElement("div");g.className="visibility_hidden",g.id="genericTemplateDecrement"+d,e.append(g),e.append(f);return this.findElements()&&(c[0].className="generic_template_element_container",f.addEventListener("click",function(){c[d].className="display_none",c[d+1].className="generic_template_element_container",document.getElementById("genericTemplateDecrement"+(d+1)).className="generic_template_decrement",d===c.length-2&&(document.getElementById("genericTemplateIncrement"+(d+1)).className="visibility_hidden")}),g.addEventListener("click",function(){c[d].className="display_none",c[d-1].className="generic_template_element_container",document.getElementById("genericTemplateIncrement"+(d-1)).className="generic_template_increment",0===d&&(document.getElementById("genericTemplateDecrement"+(d-1)).className="visibility_hidden")})),e}},{key:"genericTemplate",value:function(){var c=this,d=document.createElement("div");d.className="generic_template_container";var e=[];this.findElements().forEach(function(f,g){var h=document.createElement("div");if(e.push(h),1<c.findElements().length){h.className="display_none";var j=c.carouselButtons(e,g);h.append(j)}var k=document.createElement("img");k.src=f.image_url,k.style.width="100%",k.style.height="200px",k.style.borderRadius="10px 10px 0 0",h.prepend(k),f.default_action&&(k.onclick=function(){return window.open(f.default_action.url)});var l=document.createElement("div");if(l.className="generic_template_text_container",h.append(l),f.title){var m=document.createElement("p");m.className="text_title",m.append(f.title),l.append(m)}if(f.subtitle){var n=document.createElement("p");n.className="text_subtitle",n.append(f.subtitle),l.append(n)}f.buttons&&f.buttons.forEach(function(o){var p=c.renderButton(o);h.append(p)}),d.append(h)}),this.findButtons()&&this.findButtons().forEach(function(f){var g=c.renderButton(f);listContainer.append(g)}),this.messageContainer.append(d)}},{key:"receiptTemplate",value:function(){var c=this,d=document.createElement("div");d.className="receipt_template_outer_container";var e=document.createElement("div");e.className="receipt_template_header_container",e.append("Order confirmation"),d.append(e),this.findElements()&&this.findElements().forEach(function(v){var w=document.createElement("div");if(w.className="receipt_template_element_container",v.image_url){var x=document.createElement("img");x.style.width="50px",x.style.height="50px",x.style.border="1px solid rgba(0,0,0,0.1)",w.append(x)}var y=document.createElement("div");y.className="receipt_template_text_container";var z=document.createElement("span");z.className="text_title",z.append(v.title),y.append(z);var A=document.createElement("span");A.className="text_subtitle",A.append(v.subtitle),y.append(A),w.append(y),d.append(w)});var f=this.renderInformation("Paid with");this.messageData.payment_method&&f.append(this.messageData.payment_method),d.append(f);var g=this.renderInformation("Ship to");if(this.messageData.address){var h=this.messageData.address;g.append(h.street_1+" \n                                    "+h.city+" "+h.state+" "+h.postal_code)}d.append(g);var j=this.renderInformation("Recipient");this.messageData.recipient_name&&j.append(this.messageData.recipient_name),d.append(j);var k=this.renderInformation("Order number");this.messageData.order_number&&k.append(this.messageData.order_number),d.append(k);var l=this.renderInformation("Order URL");if(this.messageData.order_url){var m=document.createElement("span");m.className="word_break",m.append(this.messageData.order_url),l.append(m)}d.append(l);var n=this.renderInformation("Subtotal");this.messageData.summary&&this.messageData.summary.subtotal&&n.append("$"+this.messageData.summary.subtotal),d.append(n);var o=this.renderInformation("Shipping cost");this.messageData.summary&&this.messageData.summary.shipping_cost&&o.append("$"+this.messageData.summary.shipping_cost),d.append(o);var p=this.renderInformation("Total tax");this.messageData.summary&&this.messageData.summary.total_tax&&p.append("$"+this.messageData.summary.total_tax),d.append(p);var q=document.createElement("span"),r=document.createElement("div");r.className="receipt_template_information_container",q.className="text_title",q.append("Adjustments"),r.append(q),d.append(r),this.messageData.adjustments&&this.messageData.adjustments.forEach(function(v){var w=c.renderInformation(v.name);w.style.marginTop="0px",w.append("Amount:"+v.amount),d.append(w)});var s=document.createElement("div");s.className="receipt_template_summary_container";var t=document.createElement("span");t.className="receipt_template_summary_total",t.append("Total");var u=document.createElement("span");u.className="receipt_template_summary_price",this.messageData.summary&&this.messageData.summary.total_cost&&u.append("$"+this.messageData.summary.total_cost),s.append(t),s.append(u),d.append(s),this.messageContainer.append(d)}},{key:"buttonTemplate",value:function(){var c=this,d=document.createElement("div");if(d.className="button_template_outer_container",this.messageData.text){var e=document.createElement("div");e.className="button_template_text",e.appendChild(document.createTextNode(this.messageData.text)),d.appendChild(e)}this.messageData.buttons.forEach(function(g,h){var j=c.renderButton(g);0!==h&&(j.style.borderTop="1px solid rgba(0,0,0,0.1)"),j.className="button_template_container",d.append(j)}),this.messageContainer.append(d);var f=createElement("img","cognigy-chat-bot-avatar");f.src="./images/cognigy_logo.svg",this.messageContainer.append(f)}},{key:"renderMessage",value:function(){if("button"===this.findTemplate()&&this.buttonTemplate(),"list"===this.findTemplate()&&this.listTemplate(),"generic"===this.findTemplate()&&this.genericTemplate(),"receipt"===this.findTemplate()&&this.receiptTemplate(),this.renderQuickReplies(),"image"===this.messageType){var c=document.createElement("img");c.src=this.messageData.url,c.className="image_template",this.messageContainer.append(c);var d=createElement("img","cognigy-chat-bot-avatar");d.src="./images/cognigy_logo.svg",this.messageContainer.append(d)}}}]),a}();